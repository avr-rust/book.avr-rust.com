<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The built-in avr-unknown-gnu-atmega328 target - The AVR-Rust Guidebook</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="001-introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="001.1-reporting-bugs.html"><strong aria-hidden="true">1.1.</strong> Reporting bugs</a></li></ol></li><li class="chapter-item expanded "><a href="002-installing-the-compiler.html"><strong aria-hidden="true">2.</strong> Installing the compiler</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="002.1-installing-required-third-party-tools.html"><strong aria-hidden="true">2.1.</strong> Installing required third party tools</a></li></ol></li><li class="chapter-item expanded "><a href="003-building-a-crate-for-avr.html"><strong aria-hidden="true">3.</strong> Building a crate for AVR</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="003.1-the-avr-unknown-gnu-atmega328-target.html" class="active"><strong aria-hidden="true">3.1.</strong> The built-in avr-unknown-gnu-atmega328 target</a></li><li class="chapter-item expanded "><a href="003.2-note-about-rust-build-std-flag.html"><strong aria-hidden="true">3.2.</strong> A note about the required Rust -Z build-std=&lt;CRATE,&gt; flag</a></li><li class="chapter-item expanded "><a href="003.3-example-building-blink.html"><strong aria-hidden="true">3.3.</strong> Example - Building the blink program for AVR</a></li></ol></li><li class="chapter-item expanded "><a href="004-flashing-a-crate-to-chip.html"><strong aria-hidden="true">4.</strong> Flashing a crate to a real AVR chip</a></li><li class="chapter-item expanded "><a href="005-add-avr-support-to-crate.html"><strong aria-hidden="true">5.</strong> Adding AVR support to a crate</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="005.1-the-target-specification-json-file.html"><strong aria-hidden="true">5.1.</strong> The target specification JSON file</a></li><li class="chapter-item expanded "><a href="005.2-adding-no-std-attribute.html"><strong aria-hidden="true">5.2.</strong> Adding the #[no_std] attribute</a></li><li class="chapter-item expanded "><a href="005.3-creating-an-executable-entry-point.html"><strong aria-hidden="true">5.3.</strong> Creating an executable entry point with #[no_main]</a></li><li class="chapter-item expanded "><a href="005.4-choosing-an-io-library.html"><strong aria-hidden="true">5.4.</strong> Choosing an input/output library</a></li></ol></li><li class="chapter-item expanded "><a href="006-new-crate-template-quickstart.html"><strong aria-hidden="true">6.</strong> Quick start using avr-rust/template-bin</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">The AVR-Rust Guidebook</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#31-the-built-in-avr-unknown-gnu-atmega328-target" id="31-the-built-in-avr-unknown-gnu-atmega328-target">3.1. The built-in <code>avr-unknown-gnu-atmega328</code> target</a></h1>
<p>The Rust nightly compiler contains a built-in target, <code>avr-unknown-gnu-atmega328</code>, that
generates code for the AVR <a href="https://en.wikipedia.org/wiki/ATmega328">ATmega328</a> using the
GNU AVR-GCC toolchain for linking support.</p>
<h2><a class="header" href="#targeting-custom-microcontrollers-by-adapting-avr-unknown-gnu-atmega328" id="targeting-custom-microcontrollers-by-adapting-avr-unknown-gnu-atmega328">Targeting custom microcontrollers by adapting 'avr-unknown-gnu-atmega328'</a></h2>
<p>See the section <a href="./005.1-the-target-specification-json-file.html">5.1. The Target Specification JSON File</a> for
more information about how Rust target specification JSON files work.</p>
<p>To generate a Rust target specification JSON file from the builtin:</p>
<pre><code class="language-bash">rustc --print target-spec-json -Z unstable-options --target avr-unknown-gnu-atmega328 &gt; my-custom-avr-unknown-gnu-atmega328.json
</code></pre>
<p>This prints the target specification JSON file <code>my-custom-avr-unknown-gnu-atmega328.json</code>:</p>
<pre><code class="language-json">{
  &quot;arch&quot;: &quot;avr&quot;,
  &quot;cpu&quot;: &quot;atmega328&quot;,
  &quot;data-layout&quot;: &quot;e-P1-p:16:8-i8:8-i16:8-i32:8-i64:8-f32:8-f64:8-n8-a:8&quot;,
  &quot;eh-frame-header&quot;: false,
  &quot;env&quot;: &quot;&quot;,
  &quot;exe-suffix&quot;: &quot;.elf&quot;,
  &quot;executables&quot;: true,
  &quot;is-builtin&quot;: true,
  &quot;late-link-args&quot;: {
    &quot;gcc&quot;: [
      &quot;-lgcc&quot;
    ]
  },
  &quot;linker&quot;: &quot;avr-gcc&quot;,
  &quot;linker-flavor&quot;: &quot;gcc&quot;,
  &quot;linker-is-gnu&quot;: true,
  &quot;llvm-target&quot;: &quot;avr-unknown-unknown&quot;,
  &quot;os&quot;: &quot;unknown&quot;,
  &quot;pre-link-args&quot;: {
    &quot;gcc&quot;: [
      &quot;-mmcu=atmega328&quot;,
      &quot;-Wl,--as-needed&quot;
    ]
  },
  &quot;target-c-int-width&quot;: &quot;16&quot;,
  &quot;target-endian&quot;: &quot;little&quot;,
  &quot;target-pointer-width&quot;: &quot;16&quot;,
  &quot;vendor&quot;: &quot;unknown&quot;
}
</code></pre>
<p>To adapt this file to target a different microcontroller:</p>
<ul>
<li>Replace the top-level <code>&quot;cpu&quot;: &quot;atmega328&quot;</code> with <code>&quot;cpu&quot;: &quot;YOUR-AVR-VARIANT-NAME&quot;</code></li>
<li>Replace <code>&quot;-mmcu=atmega328&quot;</code> with <code>&quot;-mmcu=YOUR-AVR-VARIANT-NAME&quot;</code></li>
</ul>
<p>The file can then be passed to Rust via the <code>rustc --target &lt;JSON FILE PATH&gt;</code> instead of
<code>rustc --target avr-unknown-gnu-atmega328</code>, which will tailor the generated code to your
desired microcontroller.</p>
<p>It is also possible to customize link parameters if desired by modifying the JSON file.</p>
<h2><a class="header" href="#compiling-for-avr-without-the-gnu-toolchain" id="compiling-for-avr-without-the-gnu-toolchain">Compiling for AVR without the GNU toolchain</a></h2>
<p>At the moment, the only builtin AVR target <code>avr-unknown-gnu-atmega328</code> always requires
AVR-GCC, AVR-libc and AVR-binutils from the GNU project.</p>
<p>The LLVM LLD linker has some limited support for AVR which in the future could be leveraged
to allow compiling AVR Rust binaries without the dependency on the GNU toolchain. Some work
on <code>compiler-builtins</code> and others would also be required. At the moment, the GNU toolchain
is a hard dependency.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="003-building-a-crate-for-avr.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="003.2-note-about-rust-build-std-flag.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="003-building-a-crate-for-avr.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="003.2-note-about-rust-build-std-flag.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
